<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>äººç‹¼ã‚²ãƒ¼ãƒ  (GMé€²è¡Œ)</title>
<style>
  body { background:#121212; color:#fff; font-family:sans-serif; margin:0; }
  nav { background:#1db954; padding:.5rem; text-align:center; }
  nav h1 { margin:0; font-size:1.5rem; }
  main { max-width:960px; margin:1rem auto; padding:1rem; }

  button, select, input {
    padding:.5rem 1rem; margin:.2rem; border:none; border-radius:6px;
    cursor:pointer; font-size:1rem;
  }
  button { background:#333; color:#fff; }
  button:hover { background:#1db954; }
  input, select { background:#222; color:#fff; }

  #playerSetup, #roleSetup, #gmScreen, #resultScreen { display:none; }
  .playerList { margin-top:1rem; }
  .playerItem { margin:.3rem 0; }

  .tabs { display:flex; margin-top:1rem; }
  .tabs button { flex:1; background:#333; }
  .tabs button.active { background:#1db954; }
  .tabContent { display:none; padding:1rem; background:#1e1e1e; border-radius:8px; margin-top:1rem; }
  .tabContent.active { display:block; }

  .lists { display:flex; gap:2rem; margin-top:1rem; }
  .lists div { flex:1; background:#222; padding:1rem; border-radius:8px; }
  .dead { color:#e22134; text-decoration:line-through; }

  #resultScreen { text-align:center; padding:2rem; }
  #resultScreen h2 { font-size:2.5rem; }
  .win-citizen { background:#2e7d32; animation:flash 1s infinite alternate; }
  .win-wolf { background:#b71c1c; animation:flash 1s infinite alternate; }
  .win-fox { background:#f57f17; animation:flash 1s infinite alternate; }
  @keyframes flash { from{opacity:1;} to{opacity:0.5;} }

  #modalOverlay {
    display:none; position:fixed; top:0; left:0; width:100%; height:100%;
    background:rgba(0,0,0,0.9); z-index:1000; justify-content:center; align-items:center;
  }
  #modalContent {
    background:#1e1e1e; padding:2rem; border-radius:12px; text-align:center; max-width:500px;
    animation:pop 0.5s ease;
  }
  #modalContent h2 { font-size:2rem; margin-bottom:1rem; }
  #modalContent button { background:#1db954; }
  @keyframes pop {
    0% { transform:scale(0.7); opacity:0; }
    100% { transform:scale(1); opacity:1; }
  }

  /* å¤œã®çŠ¶æ³ç¢ºèª */
  #nightSummary { background:#333; padding:1rem; margin-top:1rem; border-radius:8px; }
</style>
</head>
<body>
  <nav><h1>äººç‹¼ã‚²ãƒ¼ãƒ  GMé€²è¡Œãƒ„ãƒ¼ãƒ«</h1></nav>
  <main>
    <!-- ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ç™»éŒ² -->
    <section id="playerSetup">
      <h2>ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ç™»éŒ²</h2>
      <input id="playerName" type="text" placeholder="åå‰ã‚’å…¥åŠ›">
      <button onclick="addPlayer()">è¿½åŠ </button>
      <div class="playerList" id="playerList"></div>
      <button onclick="gotoRoleSetup()">æ¬¡ã¸ (å½¹è·è¨­å®š)</button>
    </section>

    <!-- å½¹è·è¨­å®š -->
    <section id="roleSetup">
      <h2>å½¹è·è¨­å®š</h2>
      <div id="roleConfig"></div>
      <button onclick="assignRoles()">å½¹è·ã‚’é…å¸ƒã—ã¦ã‚²ãƒ¼ãƒ é–‹å§‹</button>
      <button onclick="restartGame()">ãƒªã‚¹ã‚¿ãƒ¼ãƒˆ</button>
    </section>

    <!-- GMé€²è¡Œç”»é¢ -->
    <section id="gmScreen">
      <h2>GMé€²è¡Œç”»é¢</h2>
      <div class="tabs">
        <button onclick="openTab('wolf')" class="active">äººç‹¼</button>
        <button onclick="openTab('seer')">å ã„å¸«</button>
        <button onclick="openTab('medium')">éœŠåª’å¸«</button>
        <button onclick="openTab('knight')">é¨å£«</button>
        <button onclick="openTab('resolve')">å‡¦ç†çµæœ</button>
      </div>

      <div id="wolf" class="tabContent active">
        <h3>äººç‹¼ã®è¥²æ’ƒå¯¾è±¡</h3>
        <div id="wolfTargets"></div>
      </div>
      <div id="seer" class="tabContent">
        <h3>å ã„å¸«ã®å ã„å¯¾è±¡</h3>
        <div id="seerTargets"></div>
      </div>
      <div id="medium" class="tabContent">
        <h3>éœŠåª’å¸«ã®å¯¾è±¡</h3>
        <div id="mediumTargets"></div>
      </div>
      <div id="knight" class="tabContent">
        <h3>é¨å£«ã®è­·è¡›å¯¾è±¡</h3>
        <div id="knightTargets"></div>
      </div>
      <div id="resolve" class="tabContent">
        <h3>å‡¦ç†çµæœ</h3>
        <div id="nightSummary"></div>
        <button onclick="resolveNight()">å¤œã‚’è§£æ±ºã™ã‚‹</button>
        <p id="nightResult"></p>
      </div>

      <!-- ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒªã‚¹ãƒˆ -->
      <div class="lists">
        <div>
          <h3>ç”Ÿå­˜è€…</h3>
          <button onclick="toggleRoleVisibility()">å½¹è·è¡¨ç¤ºåˆ‡æ›¿</button>
          <ul id="aliveList"></ul>
        </div>
        <div>
          <h3>æ­»äº¡è€…</h3>
          <ul id="deadList"></ul>
        </div>
      </div>
      <button onclick="checkWin()">å‹åˆ©åˆ¤å®š</button>
      <button onclick="restartGame()">ãƒªã‚¹ã‚¿ãƒ¼ãƒˆ</button>
      <button onclick="stopGame()">ã‚¹ãƒˆãƒƒãƒ—</button>
    </section>

    <!-- å‹åˆ©ç”»é¢ -->
    <section id="resultScreen">
      <h2 id="resultText"></h2>
      <button onclick="restartGame()">ãƒªã‚¹ã‚¿ãƒ¼ãƒˆ</button>
    </section>

    <!-- ãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div id="modalOverlay">
      <div id="modalContent">
        <h2 id="modalMessage"></h2>
        <button onclick="closeModal()">é–‰ã˜ã‚‹</button>
      </div>
    </div>
  </main>

<script>
  let players = [];
  let roles = ["å¸‚æ°‘","å ã„å¸«","é¨å£«","éœŠåª’å¸«","ãƒ‘ãƒ³å±‹","ãƒ©ãƒãƒ¼ã‚º","äººç‹¼","ç‹‚ä¿¡è€…","ç™½ç‹¼","ç‹"];
  let roleSettings = {};
  let wolfTarget=null, seerTarget=null, knightTarget=null;
  let showRoles=false;
  let lovers=[]; // ãƒ©ãƒãƒ¼ã‚ºã®ãƒšã‚¢

  function addPlayer(){
    let name=document.getElementById("playerName").value.trim();
    if(!name) return;
    players.push({name, role:null, alive:true, mediumChecked:false});
    document.getElementById("playerName").value="";
    renderPlayerList();
  }
  function renderPlayerList(){
    let list=document.getElementById("playerList");
    list.innerHTML="";
    players.forEach(p=>{
      let div=document.createElement("div");
      div.className="playerItem";
      div.textContent=p.name;
      list.appendChild(div);
    });
  }
  function gotoRoleSetup(){
    if(players.length<3){ alert("ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒå°‘ãªã™ãã¾ã™"); return; }
    document.getElementById("playerSetup").style.display="none";
    document.getElementById("roleSetup").style.display="block";
    renderRoleConfig();
  }
  function renderRoleConfig(){
    let div=document.getElementById("roleConfig");
    div.innerHTML="";
    roles.forEach(r=>{
      let input=document.createElement("input");
      input.type="number"; input.min=0; input.value=0;
      input.id="role_"+r;
      let label=document.createElement("label");
      label.textContent=r+"ï¼š";
      div.appendChild(label);
      div.appendChild(input);
      div.appendChild(document.createElement("br"));
    });
  }
  function assignRoles(){
    roleSettings={}; let total=0;
    roles.forEach(r=>{
      let val=parseInt(document.getElementById("role_"+r).value||0);
      if(r==="ãƒ©ãƒãƒ¼ã‚º" && val===1) val=2;
      if(val>0){ roleSettings[r]=val; total+=val; }
    });
    if(total!==players.length){ alert("å½¹è·äººæ•°ã¨ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼æ•°ãŒä¸€è‡´ã—ã¦ã„ã¾ã›ã‚“"); return; }
    let bag=[]; for(let r in roleSettings){ for(let i=0;i<roleSettings[r];i++) bag.push(r); }
    bag=bag.sort(()=>Math.random()-0.5);
    players.forEach((p,i)=>{ p.role=bag[i]; p.alive=true; p.mediumChecked=false; });
    assignLovers();
    startGame();
  }
  function assignLovers(){
    lovers=[];
    let loversPlayers=players.filter(p=>p.role==="ãƒ©ãƒãƒ¼ã‚º");
    if(loversPlayers.length===2){
      lovers=[loversPlayers[0], loversPlayers[1]];
    }
  }
  function startGame(){
    document.getElementById("roleSetup").style.display="none";
    document.getElementById("gmScreen").style.display="block";
    renderAll();
  }
  function restartGame(){
    players=[]; roleSettings={}; lovers=[];
    wolfTarget=seerTarget=knightTarget=null;
    document.getElementById("playerSetup").style.display="block";
    document.getElementById("roleSetup").style.display="none";
    document.getElementById("gmScreen").style.display="none";
    document.getElementById("resultScreen").style.display="none";
    document.body.className="";
    document.getElementById("resultText").textContent="";
    renderPlayerList();
  }
  function stopGame(){
    document.getElementById("playerSetup").style.display="none";
    document.getElementById("roleSetup").style.display="none";
    document.getElementById("gmScreen").style.display="none";
    document.getElementById("resultScreen").style.display="block";
    document.body.className="";
    document.getElementById("resultText").textContent="ã‚²ãƒ¼ãƒ ã‚’çµ‚äº†ã—ã¾ã—ãŸ";
  }

  function openTab(id){
    document.querySelectorAll(".tabContent").forEach(c=>c.classList.remove("active"));
    document.querySelectorAll(".tabs button").forEach(b=>b.classList.remove("active"));
    document.getElementById(id).classList.add("active");
    event.target.classList.add("active");
    renderAll();
  }

  function renderAll(){
    renderPlayerLists();
    renderTargets("wolfTargets", setWolfTarget);
    renderTargets("seerTargets", setSeerTarget);
    renderTargets("knightTargets", setKnightTarget);
    renderMedium();
    renderNightSummary();
  }

  function renderPlayerLists(){
    let alive=document.getElementById("aliveList");
    let dead=document.getElementById("deadList");
    alive.innerHTML=""; dead.innerHTML="";
    players.forEach(p=>{
      let li=document.createElement("li");
      if(p.alive){
        li.textContent = showRoles ? `${p.name} (${p.role})` : p.name;
        alive.appendChild(li);
      } else {
        li.textContent = `${p.name} (${p.role})`;
        li.className="dead";
        dead.appendChild(li);
      }
    });
  }

  function toggleRoleVisibility(){
    showRoles=!showRoles;
    renderPlayerLists();
  }

  function renderTargets(containerId, callback){
    let div=document.getElementById(containerId);
    div.innerHTML="";
    players.filter(p=>p.alive).forEach(p=>{
      let btn=document.createElement("button");
      btn.textContent=p.name;
      btn.onclick=()=>callback(p);
      div.appendChild(btn);
    });
  }

  function renderMedium(){
    let div=document.getElementById("mediumTargets");
    div.innerHTML="";
    let dead=players.filter(p=>!p.alive && !p.mediumChecked);
    dead.forEach(p=>{
      let btn=document.createElement("button");
      btn.textContent=p.name;
      btn.onclick=()=>{
        p.mediumChecked=true;
        let res=(p.role==="äººç‹¼")?"äººç‹¼":
                (p.role==="ç™½ç‹¼")?"ç™½ç‹¼":
                (p.role==="ãƒ©ãƒãƒ¼ã‚º")?"ãƒ©ãƒãƒ¼ã‚º":"å¸‚æ°‘";
        showModal(`éœŠåª’çµæœ: ${p.name} ã¯ ${res}`);
      };
      div.appendChild(btn);
    });
  }

  function setWolfTarget(p){ wolfTarget=p; renderNightSummary(); }
  function setSeerTarget(p){
    seerTarget=p;
    let res="";
    if(p.role==="äººç‹¼"){ res="äººç‹¼"; }
    else if(p.role==="ç™½ç‹¼"){ res="å¸‚æ°‘"; }
    else { res="å¸‚æ°‘"; }
    showModal(`å ã„çµæœ: ${p.name} ã¯ ${res}`);
    renderNightSummary();
  }
  function setKnightTarget(p){ knightTarget=p; renderNightSummary(); }

  function renderNightSummary(){
    let div=document.getElementById("nightSummary");
    let txt="";
    if(wolfTarget) txt+=`äººç‹¼è¥²æ’ƒäºˆå®š: ${wolfTarget.name}<br>`;
    if(seerTarget){
      let res=(seerTarget.role==="äººç‹¼")?"äººç‹¼":
              (seerTarget.role==="ç™½ç‹¼")?"å¸‚æ°‘":"å¸‚æ°‘";
      txt+=`å ã„å¸«å ã„äºˆå®š: ${seerTarget.name} â†’ ${res}<br>`;
    }
    if(knightTarget) txt+=`é¨å£«è­·è¡›äºˆå®š: ${knightTarget.name}<br>`;
    div.innerHTML=txt||"ã¾ã é¸æŠãŒã‚ã‚Šã¾ã›ã‚“";
  }

  function resolveNight(){
    let result="";
    // è¥²æ’ƒ
    if(wolfTarget){
      if(knightTarget && wolfTarget===knightTarget){
        result+="é¨å£«ãŒ "+knightTarget.name+" ã‚’å®ˆã‚Šã€è¥²æ’ƒå¤±æ•—ï¼<br>";
      }else{
        wolfTarget.alive=false;
        result+=wolfTarget.name+" ãŒäººç‹¼ã«è¥²æ’ƒã•ã‚Œæ­»äº¡ï¼<br>";
        // ãƒ©ãƒãƒ¼ã‚ºå‡¦ç†
        if(lovers.includes(wolfTarget)){
          lovers.forEach(l=>{
            if(l!==wolfTarget && l.alive){
              l.alive=false;
              result+=`ãƒ©ãƒãƒ¼ã‚ºåŠ¹æœã§ ${l.name} ã‚‚æ­»äº¡ï¼<br>`;
            }
          });
        }
      }
    }else{ result+="ä»Šå¤œã¯èª°ã‚‚è¥²æ’ƒã•ã‚Œã¾ã›ã‚“ã§ã—ãŸã€‚<br>"; }

    // ãƒ‘ãƒ³å±‹
    let bakers=players.filter(p=>p.alive && p.role==="ãƒ‘ãƒ³å±‹");
    if(bakers.length>0){
      result+="ğŸ ãƒ‘ãƒ³å±‹ãŒãƒ‘ãƒ³ã‚’ç„¼ãã¾ã—ãŸ<br>";
    }

    document.getElementById("nightResult").innerHTML=result;
    wolfTarget=seerTarget=knightTarget=null;
    renderAll();
  }

  function checkWin(){
    let alive=players.filter(p=>p.alive);
    let wolves=alive.filter(p=>p.role==="äººç‹¼"||p.role==="ç™½ç‹¼");
    let foxes=alive.filter(p=>p.role==="ç‹");
    let citizens=alive.filter(p=>!["äººç‹¼","ç™½ç‹¼","ç‹"].includes(p.role));

    if(foxes.length>0 && alive.length===foxes.length){ showResult("ç‹ã®å‹åˆ©ï¼","win-fox"); return; }
    if(wolves.length===0){ showResult("å¸‚æ°‘é™£å–¶ã®å‹åˆ©ï¼","win-citizen"); return; }
    if(wolves.length>=citizens.length){ showResult("äººç‹¼é™£å–¶ã®å‹åˆ©ï¼","win-wolf"); return; }
    alert("ã¾ã å‹æ•—ã¯ã¤ã„ã¦ã„ã¾ã›ã‚“");
  }
  function showResult(text,cls){
    document.getElementById("gmScreen").style.display="none";
    document.getElementById("resultScreen").style.display="block";
    document.getElementById("resultText").textContent=text;
    document.body.className=cls;
  }

  function showModal(msg){
    document.getElementById("modalMessage").textContent=msg;
    document.getElementById("modalOverlay").style.display="flex";
  }
  function closeModal(){
    document.getElementById("modalOverlay").style.display="none";
  }

  document.getElementById("playerSetup").style.display="block";
</script>
</body>
</html>
